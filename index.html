<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For WQC | Romantic Christmas & Fireworks</title>
    <style>
        :root { --neon-pink: #ff69b4; --neon-gold: #ffd700; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; 
            /* èƒŒæ™¯è°ƒæ•´ï¼šæ›´æ·±é‚ƒæµªæ¼«çš„ç´«çº¢å¤œç©ºåŸºè°ƒ */
            background: radial-gradient(circle at 50% 40%, #3a0a1a 0%, #1a0510 50%, #020105 100%);
            overflow: hidden; font-family: -apple-system, sans-serif; user-select: none; }
        
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 40px; }
        
        .actions { pointer-events: auto; display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; }
        .btn { 
            background: rgba(50, 0, 20, 0.4); border: 1px solid rgba(255, 100, 150, 0.3); 
            color: rgba(255, 230, 240, 0.9); padding: 10px 20px; border-radius: 50px; cursor: pointer; 
            font-size: 0.85rem; font-weight: 600; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center;
            letter-spacing: 1px;
        }
        .btn:hover { background: rgba(255, 100, 150, 0.2); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 0, 100, 0.3); }
        .btn:active { transform: scale(0.95); }
        /* ä¸»æŒ‰é’®æ”¹ä¸ºæµªæ¼«ç²‰é‡‘è‰²è°ƒ */
        .btn.primary { background: rgba(255, 105, 180, 0.2); border-color: var(--neon-pink); color: var(--neon-pink); box-shadow: 0 0 15px rgba(255, 105, 180, 0.3); }
        .btn.primary:hover { background: rgba(255, 105, 180, 0.3); box-shadow: 0 0 25px rgba(255, 105, 180, 0.5); }

        #loader { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #1a0510; z-index: 99; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.8s ease; }
        .loading-text { color: var(--neon-pink); font-family: monospace; letter-spacing: 5px; font-size: 0.9rem; margin-bottom: 15px; opacity: 0.8; }
        .progress-bar { width: 150px; height: 2px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; }
        .progress-fill { width: 50%; height: 100%; background: var(--neon-pink); animation: loadAnim 1.5s infinite ease-in-out; }

        #error-log { position: absolute; top: 0; left: 0; width: 100%; background: rgba(255,0,0,0.8); color: white; padding: 10px; font-size: 12px; z-index: 1000; display: none; }
        @keyframes loadAnim { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
    </style>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "react/jsx-runtime": "https://esm.sh/react@18.2.0/jsx-runtime",
            "three": "https://esm.sh/three@0.160.0",
            "@react-three/fiber": "https://esm.sh/@react-three/fiber@8.15.12?external=react,react-dom,three",
            "@react-three/drei": "https://esm.sh/@react-three/drei@9.96.1?external=react,react-dom,three,@react-three/fiber",
            "@react-three/postprocessing": "https://esm.sh/@react-three/postprocessing@2.16.0?external=react,react-dom,three,@react-three/fiber",
            "uuid": "https://esm.sh/uuid@9.0.1"
        }
    }
    </script>
</head>
<body>
    <div id="error-log"></div>
    <div id="loader">
        <div class="loading-text">PREPARING SURPRISE</div>
        <div class="progress-bar"><div class="progress-fill"></div></div>
    </div>

    <div id="ui-layer">
        <div class="actions">
            <div id="btn-play" class="btn primary">â–¶ PLAY MUSIC</div>
            <div id="btn-remix" class="btn">ğŸ¨ COLORS</div>
            <div id="btn-morph" class="btn">âœ¨ SHAPE</div>
            <div id="btn-snap" class="btn">ğŸ“· PHOTO</div>
        </div>
    </div>
    
    <div id="canvas-container" style="position: absolute; top:0; left:0; width:100%; height:100%"></div>

    <script>
        window.onerror = function(msg, url, line) {
            const el = document.getElementById('error-log');
            el.style.display = 'block';
            el.innerHTML += `Error: ${msg} <br>`;
            document.getElementById('loader').style.display = 'none';
        };
        setTimeout(() => {
            const l = document.getElementById('loader');
            if(l && l.style.display !== 'none') {
                l.style.opacity = 0;
                setTimeout(()=>l.style.display='none', 800);
            }
        }, 10000); 
    </script>

    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useRef, useEffect, Suspense } from 'react';
        import { createRoot } from 'react-dom/client';
        import * as THREE from 'three';
        import { Canvas, useFrame, useThree } from '@react-three/fiber';
        import { OrbitControls, Text3D, Center, Float, Sparkles, Text, Instance, Instances } from '@react-three/drei';
        import { EffectComposer, Bloom, Vignette, chromaticAberration } from '@react-three/postprocessing';

        // --- Audio Engine (ä¸å˜) ---
        class AudioEngine {
            constructor() { 
                this.ctx = null; this.analyser = null; this.dataArray = null;
                this.nextNoteTime = 0; this.timerID = null;
                // ç¨å¾®æ¸©æŸ”ä¸€ç‚¹çš„éŸ³è‰²åºåˆ—
                this.notes = [{f:659,d:0.4},{f:587,d:0.4},{f:523,d:0.4},{f:392,d:0.8}, {f:523,d:0.4},{f:587,d:0.4},{f:659,d:0.4},{f:587,d:0.8}, {f:659,d:0.4},{f:698,d:0.4},{f:783,d:0.4},{f:880,d:0.8}, {f:783,d:0.4},{f:698,d:0.4},{f:659,d:0.4},{f:587,d:0.8}];
                this.currentNoteIndex = 0;
            }
            init() {
                if (this.ctx) return;
                const AC = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AC(); this.analyser = this.ctx.createAnalyser();
                this.analyser.fftSize = 64; this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);
            }
            scheduler() {
                while (this.nextNoteTime < this.ctx.currentTime + 0.1) {
                    this.playNote(this.notes[this.currentNoteIndex], this.nextNoteTime);
                    this.nextNoteTime += this.notes[this.currentNoteIndex].d * 0.6;
                    this.currentNoteIndex++;
                    if (this.currentNoteIndex >= this.notes.length) { this.currentNoteIndex = 0; this.nextNoteTime += 1.0; }
                }
                this.timerID = window.setTimeout(this.scheduler.bind(this), 25);
            }
            playNote(note, time) {
                if(note.f === 0) return;
                const osc = this.ctx.createOscillator(); const gain = this.ctx.createGain();
                // ä½¿ç”¨ sine æ³¢ï¼Œå£°éŸ³æ›´æŸ”å’Œæµªæ¼«
                osc.type = 'sine'; osc.frequency.value = note.f;
                osc.connect(gain); gain.connect(this.analyser); this.analyser.connect(this.ctx.destination);
                osc.start(time); gain.gain.setValueAtTime(0, time);
                gain.gain.linearRampToValueAtTime(0.2, time + 0.1);
                gain.gain.exponentialRampToValueAtTime(0.001, time + note.d * 1.2);
                osc.stop(time + note.d * 1.5);
            }
            toggle() {
                if (!this.ctx) { this.init(); this.nextNoteTime = this.ctx.currentTime + 0.1; this.scheduler(); return true; }
                if (this.ctx.state === 'suspended') { this.ctx.resume(); return true; } else { this.ctx.suspend(); return false; }
            }
            getEnergy() {
                if (!this.analyser) return 0; this.analyser.getByteFrequencyData(this.dataArray);
                let sum = 0; for(let i=0; i<6; i++) sum += this.dataArray[i]; return sum / 6 / 255; 
            }
        }
        const audioSystem = new AudioEngine();

        // --- CatVoxels (Cute Beads Tree) ---
        const CatVoxels = ({ count = 2500, colors, mode, isPlaying }) => {
            const meshRef = useRef();
            const dummy = useMemo(() => new THREE.Object3D(), []);
            const particles = useMemo(() => {
                const temp = [];
                for (let i = 0; i < count; i++) {
                    const t = i / count;
                    const angle = t * Math.PI * 30 + Math.random() * 0.5; 
                    const radius = (1 - t) * 16;
                    const y = t * 42 - 21;
                    const treePos = new THREE.Vector3(Math.cos(angle)*radius, y, Math.sin(angle)*radius);
                    const scatterPos = new THREE.Vector3((Math.random()-0.5)*90, (Math.random()-0.5)*70, (Math.random()-0.5)*90);
                    temp.push({ treePos, scatterPos, pos: scatterPos.clone(), speed: Math.random()*0.4+0.6, phase: Math.random()*Math.PI*2, colorType: Math.random() });
                }
                return temp;
            }, [count]);

            useEffect(() => {
                if(!meshRef.current) return;
                particles.forEach((p, i) => {
                    const c = p.colorType<0.33?colors[0]:(p.colorType<0.66?colors[1]:colors[2]);
                    meshRef.current.setColorAt(i, c);
                });
                meshRef.current.instanceColor.needsUpdate = true;
            }, [colors]);

            useFrame((state, delta) => {
                if(!meshRef.current) return;
                const energy = audioSystem.getEnergy();
                const time = state.clock.elapsedTime;
                const isTree = mode === 'TREE';
                const pulse = isPlaying ? (1 + energy * 0.4) : 1;
                particles.forEach((p, i) => {
                    const targetBase = isTree ? p.treePos : p.scatterPos;
                    let target = targetBase.clone();
                    if(isTree) { target.applyAxisAngle(new THREE.Vector3(0,1,0), time * 0.15); target.multiplyScalar(pulse); }
                    p.pos.lerp(target, delta * 3 * p.speed);
                    let bounce = 0; if(isTree && isPlaying) bounce = Math.sin(time * 10 + p.phase) * (0.1 + energy * 3);
                    dummy.position.copy(p.pos); dummy.position.y += bounce;
                    dummy.lookAt(0, p.pos.y, 0); dummy.scale.setScalar(0.55 * (isPlaying ? (1 + energy * 0.2) : 1)); 
                    dummy.updateMatrix(); meshRef.current.setMatrixAt(i, dummy.matrix);
                });
                meshRef.current.instanceMatrix.needsUpdate = true;
            });

            return (
                <instancedMesh ref={meshRef} args={[null, null, count]}>
                    <sphereGeometry args={[0.7, 16, 16]} />
                    <meshStandardMaterial roughness={0.3} metalness={0.5} emissive="#555" emissiveIntensity={0.3} />
                </instancedMesh>
            );
        };

        // --- Decorations Component (Emoji) ---
        const Decorations = ({ mode }) => {
            const items = useMemo(() => {
                const emojis = ['ğŸ§¦', 'ğŸ¬', 'ğŸ­', 'ğŸ€', 'ğŸ””', 'ğŸ', 'ğŸ’–', 'âœ¨'];
                const temp = [];
                for(let i=0; i<50; i++) {
                    const t = Math.random() * 0.9 + 0.05; 
                    const angle = Math.random() * Math.PI * 2;
                    const radius = (1 - t) * 16 * 1.25; 
                    const y = t * 42 - 21;
                    temp.push({ basePos: new THREE.Vector3(Math.cos(angle)*radius, y, Math.sin(angle)*radius), emoji: emojis[Math.floor(Math.random() * emojis.length)], scale: 1.5 + Math.random() * 0.8, rotationOffset: Math.random() * Math.PI * 2, bobSpeed: 0.5 + Math.random() });
                }
                return temp;
            }, []);
            const groupRef = useRef();
            useFrame((state) => {
                if(!groupRef.current || mode !== 'TREE') return;
                const time = state.clock.elapsedTime;
                groupRef.current.children.forEach((child, i) => {
                    const item = items[i]; const pos = item.basePos.clone();
                    pos.applyAxisAngle(new THREE.Vector3(0,1,0), time * 0.15);
                    pos.y += Math.sin(time * item.bobSpeed + item.rotationOffset) * 0.4;
                    child.position.copy(pos); child.lookAt(0, pos.y, 0); child.rotation.y += Math.PI; 
                });
            });
            if (mode !== 'TREE') return null;
            return (
                <group ref={groupRef}>
                    {items.map((item, i) => (
                        <Text key={i} fontSize={item.scale} anchorX="center" anchorY="middle" outlineWidth={0.05} outlineColor="#5a1a2c">
                            {item.emoji}
                        </Text>
                    ))}
                </group>
            );
        };

        // --- NEW: Top Heart Component (æµªæ¼«æ¡ƒå¿ƒ) ---
        const TopHeart = ({ isPlaying }) => {
            const heartRef = useRef();
            const lightRef = useRef();

            // åˆ›å»ºçˆ±å¿ƒå½¢çŠ¶
            const heartShape = useMemo(() => {
                const shape = new THREE.Shape();
                const x = 0, y = 0;
                shape.moveTo(x + 2.5, y + 2.5);
                shape.bezierCurveTo(x + 2.5, y + 2.5, x + 2.0, y, x, y);
                shape.bezierCurveTo(x - 3.0, y, x - 3.0, y + 3.5, x - 3.0, y + 3.5);
                shape.bezierCurveTo(x - 3.0, y + 5.5, x - 1.0, y + 7.7, x + 2.5, y + 9.5);
                shape.bezierCurveTo(x + 6.0, y + 7.7, x + 8.0, y + 5.5, x + 8.0, y + 3.5);
                shape.bezierCurveTo(x + 8.0, y + 3.5, x + 8.0, y, x + 5.0, y);
                shape.bezierCurveTo(x + 3.5, y, x + 2.5, y + 2.5, x + 2.5, y + 2.5);
                return shape;
            }, []);

            // çˆ±å¿ƒæŒ¤å‹é…ç½®
            const extrudeSettings = useMemo(() => ({
                steps: 2, depth: 2, bevelEnabled: true, bevelThickness: 0.6, bevelSize: 0.5, bevelSegments: 8
            }), []);

            useFrame((state) => {
                if (!heartRef.current) return;
                const time = state.clock.elapsedTime;
                // ç¼“æ…¢æ—‹è½¬
                heartRef.current.rotation.y = time * 0.6;
                // è½»å¾®æµ®åŠ¨
                heartRef.current.position.y = Math.sin(time * 1.5) * 0.3;

                // å‘¼å¸æ„Ÿç¼©æ”¾
                const scale = 0.35 + Math.sin(time * 2.5) * 0.03;
                heartRef.current.scale.setScalar(scale);
                
                // é¢œè‰²åœ¨æ¡ƒçº¢å’Œæ·±ç²‰ä¹‹é—´ç¼“æ…¢å˜åŒ–
                const hue = 0.9 + Math.sin(time * 0.5) * 0.05; // around pink/magenta
                const color = new THREE.Color().setHSL(hue, 1, 0.6);
                heartRef.current.material.color = color;
                heartRef.current.material.emissive = color;

                if(lightRef.current) {
                    lightRef.current.color = color;
                    // éŸ³ä¹æ’­æ”¾æ—¶ç¯å…‰æ›´äº®
                    lightRef.current.intensity = isPlaying ? 8 : 5;
                }
            });

            return (
                <group position={[0, 22.5, 0]}>
                    <Center>
                        <mesh ref={heartRef} rotation={[Math.PI, 0, 0]}> {/* ç¿»è½¬ä¸€ä¸‹è®©å°–ç«¯æœä¸‹ */}
                            <extrudeGeometry args={[heartShape, extrudeSettings]} />
                            <meshStandardMaterial 
                                toneMapped={false} 
                                emissiveIntensity={2.5} // å¼ºçƒˆå‘å…‰
                                roughness={0.2} 
                                metalness={0.8} 
                                color="#ff1493" // æ·±ç²‰è‰²åŸºè°ƒ
                                emissive="#ff1493"
                            />
                        </mesh>
                    </Center>
                    {/* æ¡ƒçº¢è‰²çš„ç‚¹å…‰æºç…§äº®æ ‘é¡¶ */}
                    <pointLight ref={lightRef} distance={25} decay={2} color="#ff1493" />
                    {/* ä¸“å±å¿ƒå½¢å‘¨å›´çš„é—ªå…‰ */}
                    <Sparkles count={30} scale={8} size={5} speed={0.5} opacity={1} color="#ffb6c1" />
                </group>
            );
        };

        // --- NEW: Styled Fireworks (èƒŒæ™¯çƒŸèŠ±) ---
        // è¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„çƒŸèŠ±æ•ˆæœï¼Œæ¨¡æ‹Ÿè¿œå¤„éšæœºç»½æ”¾çš„å…‰çƒç¾¤
        const StyledFireworks = () => {
            const ref = useRef();
            // ç”Ÿæˆä¸€äº›éšæœºä½ç½®çš„â€œçƒŸèŠ±æŸâ€
            const bursts = useMemo(() => {
                return Array.from({ length: 8 }).map(() => ({
                    // éšæœºä½ç½®åœ¨è¿œå¤„
                    position: new THREE.Vector3((Math.random()-0.5)*150, Math.random()*60 - 10, (Math.random()-0.5)*150 - 50),
                    // éšæœºé¢œè‰² (ç²‰, é‡‘, çº¢, ç´«)
                    color: ['#ff69b4', '#ffd700', '#ff0033', '#a020f0'][Math.floor(Math.random()*4)],
                    // éšæœºå¯åŠ¨æ—¶é—´åç§»
                    offset: Math.random() * 10,
                    speed: 0.5 + Math.random() * 0.5
                }));
            }, []);

            useFrame((state) => {
                if(!ref.current) return;
                const time = state.clock.elapsedTime;
                ref.current.children.forEach((group, i) => {
                   const burst = bursts[i];
                   // å¾ªç¯æ’­æ”¾ï¼šè†¨èƒ€ -> æ¶ˆå¤±
                   const t = ((time + burst.offset) * burst.speed) % 4; // 4ç§’ä¸€ä¸ªå‘¨æœŸ
                   let scale = 0;
                   let opacity = 0;
                   
                   if (t < 2.5) {
                       // å¿«é€Ÿè†¨èƒ€æœŸ
                       scale = t * 6; // å˜å¤§
                       opacity = 1 - (t / 2.5); // æ¸éš
                   }
                   
                   // åº”ç”¨åˆ° group é‡Œçš„æ‰€æœ‰ç²’å­
                   group.scale.setScalar(scale);
                   group.children.forEach(mesh => {
                       mesh.material.opacity = opacity;
                   });
                });
            });

            return (
                <group ref={ref}>
                    {bursts.map((burst, i) => (
                        <group key={i} position={burst.position}>
                            {/* æ¯ä¸ªçƒŸèŠ±æŸç”±å‡ ä¸ªç®€å•çš„å‘å…‰çƒä½“ç»„æˆ */}
                            <Instances limit={6}>
                                <sphereGeometry args={[0.8, 8, 8]} />
                                <meshBasicMaterial transparent color={burst.color} blending={THREE.AdditiveBlending} depthWrite={false} />
                                {Array.from({ length: 6 }).map((_, j) => (
                                    <Instance key={j} position={[(Math.random()-0.5)*10, (Math.random()-0.5)*10, (Math.random()-0.5)*10]} scale={0.5+Math.random()} />
                                ))}
                            </Instances>
                        </group>
                    ))}
                </group>
            );
        }


        const Scene = ({ colors, mode, setMode }) => {
            const [playing, setPlaying] = useState(false);
            
            useEffect(() => {
                const btnPlay = document.getElementById('btn-play');
                const btnRemix = document.getElementById('btn-remix');
                const btnSnap = document.getElementById('btn-snap');
                const btnMorph = document.getElementById('btn-morph');
                btnPlay.onclick = () => { 
                    const isNowPlaying = audioSystem.toggle();
                    setPlaying(isNowPlaying);
                    if(isNowPlaying) { btnPlay.innerText = "â¸ PAUSE"; btnPlay.classList.remove('primary'); } else { btnPlay.innerText = "â–¶ PLAY MUSIC"; btnPlay.classList.add('primary'); }
                };
                btnRemix.onclick = () => window.changeColors(); 
                btnMorph.onclick = () => setMode(prev => prev==='TREE'?'SCATTER':'TREE');
                btnSnap.onclick = () => {
                    const canvas = document.querySelector('canvas');
                    const link = document.createElement('a'); link.download = 'WQC-Christmas.png'; link.href = canvas.toDataURL('image/png'); link.click();
                };
            }, []);

            return (
                <>
                    {/* ç¯å…‰è°ƒæ•´ï¼šæ›´æš–ã€æ›´æµªæ¼«çš„ç²‰/ç´«è°ƒ */}
                    <ambientLight intensity={0.8} color="#ffcce6" /> {/* ç²‰è‰²ç¯å¢ƒå…‰ */}
                    <directionalLight position={[0, 10, 20]} intensity={2.0} color="#fff0f5" />
                    <directionalLight position={[-20, 5, 0]} intensity={2.5} color="#ff66b2" /> {/* å¼ºçƒˆçš„ç²‰è‰²ä¾§å…‰ */}
                    <directionalLight position={[20, -5, 0]} intensity={1.5} color="#ffcc00" /> {/* æš–é‡‘è‰²è¡¥å…‰ */}
                    {/* é¡¶éƒ¨å°„ç¯æ”¹ä¸ºæŸ”å’Œçš„ç´«ç²‰è‰² */}
                    <spotLight position={[0, 50, 0]} intensity={40} angle={0.6} color="#d87093" penumbra={1} />
                    {/* åº•éƒ¨æš–å…‰ */}
                    <pointLight position={[0, -10, 0]} intensity={5} distance={30} color="#ff4500" />
                    
                    {/* èƒŒæ™¯çƒŸèŠ± */}
                    <StyledFireworks />

                    <CatVoxels count={2400} colors={colors} mode={mode} isPlaying={playing} />
                    <Decorations mode={mode} />

                    {/* ä½¿ç”¨æ–°çš„çˆ±å¿ƒç»„ä»¶æ›¿ä»£æ˜Ÿæ˜Ÿ */}
                    { mode === 'TREE' && <TopHeart isPlaying={playing} /> }
                    
                    {/* èƒŒæ™¯ç²’å­ï¼šå¢åŠ ç²‰è‰²å’Œé‡‘è‰² */}
                    <Sparkles count={800} scale={[120, 120, 150]} size={4} speed={0.3} opacity={0.6} color="#ffb6c1" />
                    <Sparkles count={400} scale={[100, 100, 100]} size={3} speed={0.5} opacity={0.5} color="#ffd700" />
                    
                    {/* UIä¿®å¤ï¼šå°†æ–‡å­—ä½ç½®ä» -28 ä¸‹ç§»åˆ° -38ï¼Œé¿å…é‡å  */}
                    <group position={[0, -38, 0]}>
                        <Float speed={1.5} rotationIntensity={0.15} floatIntensity={0.3}>
                            <Center>
                                <Text3D 
                                    font="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/fonts/helvetiker_bold.typeface.json"
                                    size={4.5} height={0.3} curveSegments={12} bevelEnabled bevelThickness={0.1}
                                >
                                    TO WQC
                                    {/* æ–‡å­—æè´¨ï¼šæµªæ¼«çš„ç«ç‘°é‡‘/ç²‰è‰²é‡‘å±æ„Ÿ */}
                                    <meshStandardMaterial color={"#ff69b4"} emissive={"#d42424"} emissiveIntensity={0.4} metalness={0.7} roughness={0.1} />
                                </Text3D>
                            </Center>
                        </Float>
                    </group>

                    <EffectComposer disableNormalPass>
                        {/* è¾‰å…‰æ›´å¼ºï¼Œè¥é€ æ¢¦å¹»æ„Ÿ */}
                        <Bloom luminanceThreshold={0.6} mipmapBlur intensity={2.2} radius={0.6} />
                        {/* æš—è§’æ›´é‡ï¼Œèšç„¦ä¸­å¿ƒ */}
                        <Vignette eskil={false} offset={0.1} darkness={0.65} />
                    </EffectComposer>
                </>
            );
        };

        const App = () => {
            const [mode, setMode] = useState('TREE');
            // åˆå§‹é…è‰²ï¼šç»å…¸çš„çº¢ç»¿é‡‘ï¼Œä½†æ›´æ·±é‚ƒä¸€ç‚¹
            const [colors, setColors] = useState([new THREE.Color('#c71585'), new THREE.Color('#006400'), new THREE.Color('#FFD700')]);
            
            useEffect(() => {
                window.changeColors = () => {
                    setColors([
                        new THREE.Color('#'+Math.floor(Math.random()*16777215).toString(16)),
                        new THREE.Color('#'+Math.floor(Math.random()*16777215).toString(16)),
                        new THREE.Color('#'+Math.floor(Math.random()*16777215).toString(16))
                    ]);
                };
                const l = document.getElementById('loader');
                if(l) setTimeout(() => { l.style.opacity = 0; setTimeout(()=>l.style.display='none', 800); }, 2000);
            }, []);

            return (
                <Canvas dpr={[1, 1.5]} gl={{ antialias: false, toneMapping: THREE.ACESFilmicToneMapping }} camera={{ position: [0, 0, 65], fov: 45 }}>
                    <Suspense fallback={null}>
                        <Scene colors={colors} mode={mode} setMode={setMode} />
                    </Suspense>
                    <OrbitControls enablePan={false} maxDistance={100} minDistance={30} autoRotate={true} autoRotateSpeed={0.5} />
                </Canvas>
            );
        };

        const root = createRoot(document.getElementById('canvas-container'));
        root.render(<App />);
    </script>
</body>
</html>
